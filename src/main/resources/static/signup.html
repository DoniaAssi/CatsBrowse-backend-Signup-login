<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8" />
    <title>Sign up ‚Äî Cats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            crossorigin="anonymous"
    />
</head>
<body class="bg-light">
<main class="container">
    <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-7 col-lg-5">
            <div class="text-center mt-5 mb-3">
                <h2 class="fw-semibold">Create account</h2>
                <p class="text-muted mb-0">Join and save your favorite cats üêæ</p>
            </div>

            <div id="err" class="alert alert-danger d-none" role="alert"></div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <form id="signupForm" novalidate>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email address</label>
                            <input id="email" type="email" class="form-control" placeholder="name@example.com" required />
                            <div class="invalid-feedback">Please enter a valid email.</div>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label d-flex justify-content-between">
                                <span>Password</span>
                                <a href="#" id="togglePass" class="small text-decoration-none">Show</a>
                            </label>
                            <input id="password" type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6"/>
                            <div class="invalid-feedback">Password must be at least 6 characters.</div>
                        </div>

                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input id="confirmPassword" type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6"/>
                            <div class="invalid-feedback">Passwords do not match.</div>
                        </div>

                        <button id="doSignup" type="submit" class="btn btn-success w-100">
                            <span class="signup-text">Sign up</span>
                            <span class="spinner-border spinner-border-sm ms-2 d-none" aria-hidden="true"></span>
                        </button>
                    </form>

                    <p class="text-center mt-3 mb-0">
                        Already have an account?
                        <a href="login.html" class="link-primary">Login</a>
                    </p>
                </div>
            </div>

            <p class="text-center text-muted mt-3 mb-5 small">¬© 2025 Cats Browse</p>
        </div>
    </div>
</main>

<script src="auth.js"></script>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"
></script>

<script>
    if (typeof isAuthed === 'function' && isAuthed()) {
        window.location.href = '/';
    }

    const form = document.getElementById('signupForm');
    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const confirmPassEl = document.getElementById('confirmPassword');
    const btn = document.getElementById('doSignup');
    const spinner = btn.querySelector('.spinner-border');
    const btnText = btn.querySelector('.signup-text');
    const err = document.getElementById('err');
    const togglePass = document.getElementById('togglePass');

    togglePass.addEventListener('click', (e) => {
        e.preventDefault();
        const isPwd = passEl.type === 'password';
        passEl.type = isPwd ? 'text' : 'password';
        confirmPassEl.type = isPwd ? 'text' : 'password';
        togglePass.textContent = isPwd ? 'Hide' : 'Show';
    });

    function setSubmitting(s) {
        btn.disabled = s;
        spinner.classList.toggle('d-none', !s);
        btnText.textContent = s ? 'Signing up...' : 'Sign up';
    }

    function showError(msg) {
        err.textContent = msg;
        err.classList.remove('d-none');
    }

    function hideError() {
        err.textContent = '';
        err.classList.add('d-none');
    }

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        hideError();

        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        if (passEl.value !== confirmPassEl.value) {
            showError('Passwords do not match.');
            return;
        }

        setSubmitting(true);
        try {
            const email = emailEl.value.trim();
            const password = passEl.value;

            if (typeof signup !== 'function') {
                throw new Error('auth.js not loaded');
            }

            await signup(email, password);
            window.location.href = '/';
        } catch (ex) {
            showError('Signup failed (email may already exist).');
            console.error(ex);
        } finally {
            setSubmitting(false);
        }
    });
</script>
</body>
</html>